<div class="dashboard-container">
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading dashboard...</p>
    </div>
  } @else {
    <!-- Header Section -->
    <div class="dashboard-header">
      <div>
        <h1>
          <mat-icon>dashboard</mat-icon>
          Compliance Dashboard
        </h1>
        <p class="welcome-message">{{ getRoleBasedWelcomeMessage() }}</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="refreshDashboard()">
          <mat-icon>refresh</mat-icon>
          Refresh
        </button>
      </div>
    </div>

    <!-- KPI Cards -->
    @if (kpis()) {
      <div class="kpi-grid">
        @if (canViewAlerts()) {
          <mat-card class="kpi-card alerts-card" [routerLink]="['/dashboard/alerts']">
            <mat-card-content>
              <div class="kpi-content">
                <div class="kpi-icon">
                  <mat-icon>warning</mat-icon>
                </div>
                <div class="kpi-details">
                  <div class="kpi-value">{{ formatNumber(kpis()?.totalAlerts || 0) }}</div>
                  <div class="kpi-label">Total Alerts</div>
                  <div class="kpi-sublabel">{{ formatNumber(kpis()?.pendingAlerts || 0) }} pending</div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        }

        @if (canViewScreening()) {
          <mat-card class="kpi-card customers-card" [routerLink]="['/dashboard/customers']">
            <mat-card-content>
              <div class="kpi-content">
                <div class="kpi-icon">
                  <mat-icon>people</mat-icon>
                </div>
                <div class="kpi-details">
                  <div class="kpi-value">{{ formatNumber(overview()?.totalCustomers || 0) }}</div>
                  <div class="kpi-label">Total Customers</div>
                  <div class="kpi-sublabel">{{ formatNumber(overview()?.highRiskAlerts || 0) }} high risk</div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        }

        @if (canViewScreening()) {
          <mat-card class="kpi-card screening-card">
            <mat-card-content>
              <div class="kpi-content">
                <div class="kpi-icon">
                  <mat-icon>search</mat-icon>
                </div>
                <div class="kpi-details">
                  <div class="kpi-value">{{ formatNumber(kpis()?.totalScreenings || 0) }}</div>
                  <div class="kpi-label">Screenings Today</div>
                  <div class="kpi-sublabel">0 today</div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        }

        <mat-card class="kpi-card compliance-card">
          <mat-card-content>
            <div class="kpi-content">
              <div class="kpi-icon">
                <mat-icon>verified</mat-icon>
              </div>
              <div class="kpi-details">
                <div class="kpi-value">{{ complianceScoreData() ? '95.2%' : '0%' }}</div>
                <div class="kpi-label">Compliance Score</div>
                <div class="kpi-sublabel">This month</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    }

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="charts-grid">
        <!-- Alert Trends Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Alert Trends (Last 30 Days)</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (alertTrendsData()) {
              <app-chart 
                type="line" 
                [data]="alertTrendsData()" 
                [options]="lineChartOptions"
                [height]="300">
              </app-chart>
            } @else {
              <div class="chart-placeholder">
                <mat-icon>trending_up</mat-icon>
                <p>No trend data available</p>
              </div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Report Status Distribution -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Alert Status Distribution</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (reportStatusData()) {
              <app-chart 
                type="doughnut" 
                [data]="reportStatusData()" 
                [options]="pieChartOptions"
                [height]="300">
              </app-chart>
            } @else {
              <div class="chart-placeholder">
                <mat-icon>pie_chart</mat-icon>
                <p>No status data available</p>
              </div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Screening Metrics -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Screening Metrics</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (screeningMetricsData()) {
              <app-chart 
                type="bar" 
                [data]="screeningMetricsData()" 
                [options]="lineChartOptions"
                [height]="300">
              </app-chart>
            } @else {
              <div class="chart-placeholder">
                <mat-icon>bar_chart</mat-icon>
                <p>No screening data available</p>
              </div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Compliance Score History -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Compliance Score History</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (complianceScoreData()) {
              <app-chart 
                type="line" 
                [data]="complianceScoreData()" 
                [options]="lineChartOptions"
                [height]="300">
              </app-chart>
            } @else {
              <div class="chart-placeholder">
                <mat-icon>timeline</mat-icon>
                <p>No compliance data available</p>
              </div>
            }
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Recent Activities Section -->
    <div class="activities-section">
      <mat-card class="activities-card">
        <mat-card-header>
          <mat-card-title>Recent Activities</mat-card-title>
          <div class="header-actions">
            <button mat-button [routerLink]="['/dashboard/alerts']">View All</button>
          </div>
        </mat-card-header>
        <mat-card-content>
          @if (recentActivities() && recentActivities().length > 0) {
            <div class="activities-list">
              @for (activity of recentActivities(); track activity.id) {
                <div class="activity-item" [routerLink]="['/dashboard/alerts', activity.id]">
                  <div class="activity-icon">
                    <mat-icon [color]="getStatusColor(activity.priority)">
                      {{ getStatusIcon(activity.type) }}
                    </mat-icon>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">{{ activity.type }} Alert</div>
                    <div class="activity-description">
                      {{ activity.description || 'Unknown' }}
                    </div>
                    <div class="activity-meta">
                      {{ activity.title }} â€¢ {{ formatDate(activity.timestamp) }}
                    </div>
                  </div>
                  <div class="activity-actions">
                    <mat-icon>chevron_right</mat-icon>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="no-activities">
              <mat-icon>inbox</mat-icon>
              <p>No recent activities</p>
            </div>
          }
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions Section -->
    <div class="quick-actions-section">
      <mat-card class="quick-actions-card">
        <mat-card-header>
          <mat-card-title>Quick Actions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="quick-actions-grid">
            @if (canViewScreening()) {
              <button mat-raised-button color="primary" [routerLink]="['/dashboard/customers']">
                <mat-icon>person_add</mat-icon>
                Add Customer
              </button>
              <button mat-raised-button color="accent" [routerLink]="['/dashboard/screening']">
                <mat-icon>search</mat-icon>
                Screen Customer
              </button>
            }
            @if (canViewAlerts()) {
              <button mat-raised-button [routerLink]="['/dashboard/alerts']">
                <mat-icon>warning</mat-icon>
                Review Alerts
              </button>
            }
            @if (canViewReports()) {
              <button mat-raised-button [routerLink]="['/dashboard/reports']">
                <mat-icon>assessment</mat-icon>
                Generate Report
              </button>
            }
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  }
</div>