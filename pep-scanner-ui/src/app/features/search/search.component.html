<div class="search-container">
  <!-- Header -->
  <mat-card class="header-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>search</mat-icon>
        Advanced Watchlist Search
      </mat-card-title>
      <mat-card-subtitle>
        Search across global PEP, sanctions, and watchlist databases
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <!-- Search Form -->
  <mat-card class="search-form-card">
    <mat-card-content>
      <form [formGroup]="searchForm" (ngSubmit)="performSearch()">

        <!-- Basic Search Section -->
        <div class="search-section">
          <h3>Search Criteria</h3>

          <div class="basic-search-grid">
            <mat-form-field appearance="outline" class="search-term-field">
              <mat-label>Search Term *</mat-label>
              <input matInput formControlName="searchTerm"
                     placeholder="Enter name, ID, or keyword"
                     required>
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Search Type</mat-label>
              <mat-select formControlName="searchType">
                <mat-option *ngFor="let type of searchTypes" [value]="type.value">
                  {{ type.label }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Max Results</mat-label>
              <mat-select formControlName="maxResults">
                <mat-option value="50">50 Results</mat-option>
                <mat-option value="100">100 Results</mat-option>
                <mat-option value="250">250 Results</mat-option>
                <mat-option value="500">500 Results</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Matching Threshold -->
          <div class="threshold-section">
            <label class="section-label">
              Matching Threshold: {{ searchForm.get('threshold')?.value }}%
            </label>
            <input type="range" min="50" max="100" step="5" formControlName="threshold" class="threshold-slider">
            <div class="threshold-help">
              <small>Higher values = more precise matches, Lower values = more potential matches</small>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit"
                  [disabled]="searchForm.invalid || isLoading()">
            <mat-spinner diameter="20" *ngIf="isLoading()"></mat-spinner>
            <mat-icon *ngIf="!isLoading()">search</mat-icon>
            <span *ngIf="!isLoading()">Search</span>
            <span *ngIf="isLoading()">Searching...</span>
          </button>

          <button mat-button type="button" (click)="searchForm.reset()"
                  [disabled]="isLoading()">
            <mat-icon>clear</mat-icon>
            Clear
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Results Section -->
  <mat-card class="results-card" *ngIf="searchResults().length > 0 || isLoading()">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>list</mat-icon>
        Search Results
        <mat-chip-set *ngIf="searchResults().length > 0">
          <mat-chip>{{ searchResults().length }} results found</mat-chip>
        </mat-chip-set>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <!-- Loading State -->
      <div *ngIf="isLoading()" class="loading-section">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Searching across watchlist databases...</p>
      </div>

      <!-- Results Table -->
      <div *ngIf="!isLoading() && searchResults().length > 0" class="results-table-container">
        <!-- Data Table -->
        <table mat-table [dataSource]="searchResults()" class="results-table">

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let row">
              <span class="primary-name">{{ row.name }}</span>
            </td>
          </ng-container>

          <!-- Source Column -->
          <ng-container matColumnDef="source">
            <th mat-header-cell *matHeaderCellDef>Source</th>
            <td mat-cell *matCellDef="let row">
              <mat-chip [color]="getRiskLevelColor(row.source)">
                {{ row.source }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- List Type Column -->
          <ng-container matColumnDef="listType">
            <th mat-header-cell *matHeaderCellDef>List Type</th>
            <td mat-cell *matCellDef="let row">
              <span class="list-type">{{ row.listType }}</span>
            </td>
          </ng-container>

          <!-- Risk Level Column -->
          <ng-container matColumnDef="riskLevel">
            <th mat-header-cell *matHeaderCellDef>Risk Level</th>
            <td mat-cell *matCellDef="let row">
              <mat-chip [color]="getRiskLevelColor(row.riskLevel)">
                {{ row.riskLevel }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Country Column -->
          <ng-container matColumnDef="country">
            <th mat-header-cell *matHeaderCellDef>Country</th>
            <td mat-cell *matCellDef="let row">
              <span>{{ row.country || 'N/A' }}</span>
            </td>
          </ng-container>

          <!-- Match Score Column -->
          <ng-container matColumnDef="matchScore">
            <th mat-header-cell *matHeaderCellDef>Match Score</th>
            <td mat-cell *matCellDef="let row">
              <span class="score-value">{{ formatMatchScore(row.matchScore) }}</span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let row">
              <button mat-icon-button (click)="viewDetails(row)">
                <mat-icon>visibility</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <!-- No Results -->
      <div *ngIf="!isLoading() && searchResults().length === 0 && searchForm.get('searchTerm')?.value"
           class="no-results">
        <mat-icon>search_off</mat-icon>
        <h3>No Results Found</h3>
        <p>Try adjusting your search criteria</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
