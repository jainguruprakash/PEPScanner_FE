<div class="screening-container">
  <!-- Notifications -->
  <div class="notifications" *ngIf="notifications().length > 0">
    <mat-card *ngFor="let notification of notifications()" class="notification-card">
      <mat-icon>info</mat-icon>
      <span>{{ notification }}</span>
    </mat-card>
  </div>

  <mat-tab-group>
    <!-- Single Screening Tab -->
    <mat-tab label="Single Customer">
      <mat-card class="main-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>search</mat-icon>
        Customer Screening
      </mat-card-title>
      <mat-card-subtitle>
        Screen customers against global watchlists and sanctions databases
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="singleScreeningForm" (ngSubmit)="screenSingleCustomer()">

        <!-- Quick Templates -->
        <div class="templates-section">
          <mat-form-field appearance="outline">
            <mat-label>Quick Templates</mat-label>
            <mat-select (selectionChange)="loadTemplate($event.value)">
              <mat-option value="">Select Template</mat-option>
              <mat-option *ngFor="let template of searchTemplates()" [value]="template.id">
                {{ template.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <button mat-button (click)="saveCurrentAsTemplate()">
            <mat-icon>save</mat-icon> Save as Template
          </button>
        </div>

        <!-- Basic Information Section -->
        <div class="form-section">
          <h3>Customer Information</h3>
          <p class="section-description">
            <mat-icon>info</mat-icon>
            Only customer name is required. All other fields are optional and will be used to refine search results.
          </p>

          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>Full Name *</mat-label>
              <input matInput formControlName="fullName" required
                     placeholder="Enter customer's full name">
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="singleScreeningForm.get('fullName')?.hasError('required')">
                Full name is required for screening
              </mat-error>
              <mat-error *ngIf="singleScreeningForm.get('fullName')?.hasError('minlength')">
                Full name must be at least 2 characters
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Date of Birth</mat-label>
              <input matInput [matDatepicker]="dobPicker" formControlName="dateOfBirth">
              <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
              <mat-datepicker #dobPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Nationality</mat-label>
              <mat-select formControlName="nationality">
                <mat-option value="">Select Nationality</mat-option>
                <mat-option *ngFor="let country of countries" [value]="country">
                  {{ country }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Country of Residence</mat-label>
              <mat-select formControlName="country">
                <mat-option value="">Select Country</mat-option>
                <mat-option *ngFor="let country of countries" [value]="country">
                  {{ country }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Identification Number</mat-label>
              <input matInput formControlName="identificationNumber"
                     placeholder="Enter ID number">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Identification Type</mat-label>
              <mat-select formControlName="identificationType">
                <mat-option value="">Select ID Type</mat-option>
                <mat-option *ngFor="let idType of identificationTypes" [value]="idType">
                  {{ idType }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <!-- Screening Options -->
        <div class="form-section">
          <h3>Screening Options</h3>

          <div class="options-grid">
            <!-- Matching Threshold -->
            <div class="threshold-section">
              <label class="section-label">Matching Threshold: {{ singleScreeningForm.get('threshold')?.value }}%</label>
              <mat-slider min="50" max="100" step="5" discrete>
                <input matSliderThumb formControlName="threshold">
              </mat-slider>
              <div class="threshold-help">
                <small>Higher values = more precise matches, Lower values = more potential matches</small>
              </div>
            </div>

            <!-- Data Sources -->
            <div class="sources-section" formArrayName="sources">
              <label class="section-label">
                Watchlist Sources *
                <span class="selected-count">({{ getSelectedSourcesCount() }} selected)</span>
              </label>
              <div class="checkbox-grid">
                <mat-checkbox
                  *ngFor="let source of availableSources; let i = index"
                  [formControlName]="i"
                  [matTooltip]="source.description || source.label">
                  {{ source.label }}
                </mat-checkbox>
              </div>
              <div class="sources-help">
                <small>
                  <mat-icon>info</mat-icon>
                  Select at least one watchlist source to search. Each source will be searched independently.
                </small>
              </div>
              <div class="sources-error" *ngIf="getSelectedSourcesCount() === 0 && singleScreeningForm.get('sources')?.touched">
                <mat-icon>error</mat-icon>
                Please select at least one data source for screening
              </div>
            </div>

            <!-- Matching Options -->
            <div class="matching-options">
              <label class="section-label">Matching Options</label>
              <div class="checkbox-grid">
                <mat-checkbox formControlName="includeAliases">
                  Include Aliases & Alternative Names
                </mat-checkbox>
                <mat-checkbox formControlName="includeFuzzyMatching">
                  Enable Fuzzy Matching
                </mat-checkbox>
                <mat-checkbox formControlName="includePhoneticMatching">
                  Enable Phonetic Matching
                </mat-checkbox>
              </div>
              <div class="matching-help">
                <small>Fuzzy matching finds similar names, phonetic matching finds names that sound alike</small>
              </div>
            </div>

            <!-- Dynamic Configurable Options (Future Enhancement) -->
            <div class="dynamic-options" *ngIf="screeningConfig.length > 0">
              <label class="section-label">Additional Options</label>
              <div class="config-preview">
                <p class="config-note">
                  <mat-icon>info</mat-icon>
                  {{ screeningConfig.length }} configurable options available.
                  <button mat-button (click)="showConfigOptions = !showConfigOptions">
                    {{ showConfigOptions ? 'Hide' : 'Show' }} Options
                  </button>
                </p>

                <!-- Preview of configurable options -->
                <div *ngIf="showConfigOptions" class="config-options-preview">
                  <div *ngFor="let category of getScreeningCategories()" class="config-category-preview">
                    <h5>{{ getCategoryTitle(category) }}</h5>
                    <div class="config-items">
                      <span *ngFor="let config of getConfigByCategory(category)"
                            class="config-item-tag">
                        {{ config.label }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Screening Summary -->
        <div class="screening-summary" *ngIf="getSelectedSourcesCount() > 0">
          <h4>Screening Summary</h4>
          <div class="summary-content">
            <div class="summary-item">
              <mat-icon>person</mat-icon>
              <span>Customer: {{ singleScreeningForm.get('fullName')?.value || 'Not specified' }}</span>
            </div>
            <div class="summary-item">
              <mat-icon>source</mat-icon>
              <span>Sources: {{ getSelectedSourceNames().join(', ') }}</span>
            </div>
            <div class="summary-item">
              <mat-icon>tune</mat-icon>
              <span>Threshold: {{ singleScreeningForm.get('threshold')?.value }}%</span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit"
                  [disabled]="singleScreeningForm.invalid || isLoading() || getSelectedSourcesCount() === 0">
            <mat-spinner diameter="20" *ngIf="isLoading()"></mat-spinner>
            <mat-icon *ngIf="!isLoading()">search</mat-icon>
            <span *ngIf="!isLoading()">Screen Customer</span>
            <span *ngIf="isLoading()">Screening...</span>
          </button>

          <!-- Debug Button (temporary) -->
          <button mat-button type="button" (click)="debugFormState()"
                  style="margin-left: 12px; background: #fff3e0;">
            <mat-icon>bug_report</mat-icon>
            Debug Form
          </button>

          <button mat-button type="button" (click)="clearSingleForm()"
                  [disabled]="isLoading()">
            <mat-icon>clear</mat-icon>
            <span>Clear Form</span>
          </button>

          <button mat-button [matMenuTriggerFor]="exportMenu"
                  [disabled]="!result() || isLoading()">
            <mat-icon>download</mat-icon>
            <span>Export</span>
          </button>
          <mat-menu #exportMenu="matMenu">
            <button mat-menu-item (click)="exportResults('json')">
              <mat-icon>code</mat-icon>
              <span>JSON</span>
            </button>
            <button mat-menu-item (click)="exportResults('pdf')">
              <mat-icon>picture_as_pdf</mat-icon>
              <span>PDF Report</span>
            </button>
            <button mat-menu-item (click)="exportResults('excel')">
              <mat-icon>table_chart</mat-icon>
              <span>Excel</span>
            </button>
          </mat-menu>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
    </mat-tab>

    <!-- Bulk Screening Tab -->
    <mat-tab label="Bulk Screening">
      <mat-card class="main-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>upload_file</mat-icon>
            Bulk Customer Screening
          </mat-card-title>
          <mat-card-subtitle>
            Screen multiple customers simultaneously against all watchlists
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <!-- Sample File Download -->
          <div class="sample-files-header">
            <h4>Download Template Files</h4>
            <p>Download sample files to see the required format for bulk screening</p>
            <div class="sample-buttons">
              <button mat-raised-button color="accent" (click)="downloadSampleFile('csv')">
                <mat-icon>download</mat-icon> CSV Template
              </button>
              <button mat-raised-button color="accent" (click)="downloadSampleFile('excel')">
                <mat-icon>download</mat-icon> Excel Template
              </button>
            </div>
          </div>
          
          <form [formGroup]="bulkScreeningForm">
            <!-- File Upload Section -->
            <div class="bulk-upload-section">
              <div class="upload-area" [class.dragover]="isDragOver" 
                   (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" 
                   (drop)="onFileDrop($event)" (click)="fileInput.click()">
                <input type="file" #fileInput (change)="uploadBulkFile($event)" 
                       accept=".csv,.xlsx,.xls" style="display: none">
                <div class="upload-content">
                  <mat-icon class="upload-icon">cloud_upload</mat-icon>
                  <h3>Drop files here or click to upload</h3>
                  <p>Supported formats: CSV, Excel (.xlsx, .xls)</p>
                  <p class="file-requirements">Required columns: Name, Country (optional), DOB (optional)</p>
                </div>
              </div>
            </div>

            <!-- Bulk Screening Options -->
            <div class="bulk-options" *ngIf="uploadedFile()">
              <h3>Screening Configuration</h3>
              
              <div class="options-grid">
                <!-- Threshold Setting -->
                <div class="threshold-section">
                  <label class="section-label">Matching Threshold: {{ bulkScreeningForm.get('threshold')?.value }}%</label>
                  <mat-slider min="50" max="100" step="5" discrete>
                    <input matSliderThumb formControlName="threshold">
                  </mat-slider>
                </div>

                <!-- Source Selection -->
                <div class="sources-section" formArrayName="bulkSources">
                  <label class="section-label">Watchlist Sources</label>
                  <div class="checkbox-grid">
                    <mat-checkbox *ngFor="let source of availableSources; let i = index"
                                  [formControlName]="i">
                      {{ source.label }}
                    </mat-checkbox>
                  </div>
                </div>

                <!-- Processing Options -->
                <div class="processing-options">
                  <label class="section-label">Processing Options</label>
                  <mat-checkbox formControlName="autoCreateAlerts">
                    Auto-create alerts for high-risk matches
                  </mat-checkbox>
                  <mat-checkbox formControlName="skipDuplicates">
                    Skip customers already screened today
                  </mat-checkbox>
                  <mat-checkbox formControlName="enableParallelProcessing">
                    Enable parallel processing (faster)
                  </mat-checkbox>
                </div>
              </div>

              <!-- File Preview -->
              <div class="file-preview" *ngIf="filePreview().length > 0">
                <h4>File Preview (First 5 rows)</h4>
                <mat-table [dataSource]="filePreview()" class="preview-table">
                  <ng-container matColumnDef="name">
                    <mat-header-cell *matHeaderCellDef>Name</mat-header-cell>
                    <mat-cell *matCellDef="let row">{{ row.name }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="country">
                    <mat-header-cell *matHeaderCellDef>Country</mat-header-cell>
                    <mat-cell *matCellDef="let row">{{ row.country || 'N/A' }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="dob">
                    <mat-header-cell *matHeaderCellDef>Date of Birth</mat-header-cell>
                    <mat-cell *matCellDef="let row">{{ row.dob || 'N/A' }}</mat-cell>
                  </ng-container>
                  <mat-header-row *matHeaderRowDef="['name', 'country', 'dob']"></mat-header-row>
                  <mat-row *matRowDef="let row; columns: ['name', 'country', 'dob']"></mat-row>
                </mat-table>
                <p class="preview-info">Total customers to screen: {{ totalCustomersToScreen() }}</p>
              </div>

              <!-- Start Screening Button -->
              <div class="bulk-actions">
                <button mat-raised-button color="primary" (click)="startBulkScreening()"
                        [disabled]="isBulkProcessing() || !uploadedFile()">
                  <mat-icon>play_arrow</mat-icon>
                  <span>Start Bulk Screening</span>
                </button>
                <button mat-button (click)="clearBulkForm()">
                  <mat-icon>clear</mat-icon>
                  <span>Clear</span>
                </button>
              </div>
            </div>
          </form>

          <!-- Bulk Processing Progress -->
          <div *ngIf="isBulkProcessing()" class="bulk-progress">
            <mat-card class="progress-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>hourglass_empty</mat-icon>
                  Processing Bulk Screening
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="progress-info">
                  <p>Processed: {{ bulkProgress().processed }} / {{ bulkProgress().total }}</p>
                  <p>Estimated time remaining: {{ bulkProgress().estimatedTime }}</p>
                </div>
                <mat-progress-bar mode="determinate" [value]="bulkProgress().percentage"></mat-progress-bar>
                <div class="progress-stats">
                  <div class="stat">
                    <span class="stat-label">Clear:</span>
                    <span class="stat-value">{{ bulkProgress().clear }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Low Risk:</span>
                    <span class="stat-value">{{ bulkProgress().lowRisk }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Medium Risk:</span>
                    <span class="stat-value">{{ bulkProgress().mediumRisk }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">High Risk:</span>
                    <span class="stat-value">{{ bulkProgress().highRisk }}</span>
                  </div>
                </div>
                <button mat-button color="warn" (click)="cancelBulkScreening()">
                  <mat-icon>stop</mat-icon>
                  Cancel Processing
                </button>
              </mat-card-content>
            </mat-card>
          </div>
          
          <!-- Enhanced Bulk Results -->
          <div *ngIf="bulkResults().length > 0 && !result()" class="bulk-results">
            <mat-card class="results-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>assessment</mat-icon>
                  Bulk Screening Results
                </mat-card-title>
                <mat-card-subtitle>
                  {{ bulkResults().length }} customers screened
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <!-- Results Summary -->
                <div class="results-summary">
                  <div class="summary-card clear">
                    <div class="summary-number">{{ getBulkSummary().clear }}</div>
                    <div class="summary-label">Clear</div>
                  </div>
                  <div class="summary-card low-risk">
                    <div class="summary-number">{{ getBulkSummary().lowRisk }}</div>
                    <div class="summary-label">Low Risk</div>
                  </div>
                  <div class="summary-card medium-risk">
                    <div class="summary-number">{{ getBulkSummary().mediumRisk }}</div>
                    <div class="summary-label">Medium Risk</div>
                  </div>
                  <div class="summary-card high-risk">
                    <div class="summary-number">{{ getBulkSummary().highRisk }}</div>
                    <div class="summary-label">High Risk</div>
                  </div>
                </div>

                <!-- Results Actions -->
                <div class="results-actions">
                  <button mat-raised-button color="primary" (click)="exportBulkResults('excel')">
                    <mat-icon>table_chart</mat-icon>
                    Export to Excel
                  </button>
                  <button mat-button (click)="exportBulkResults('pdf')">
                    <mat-icon>picture_as_pdf</mat-icon>
                    Generate Report
                  </button>
                  <button mat-button (click)="createBulkAlerts()" 
                          [disabled]="getBulkSummary().highRisk === 0">
                    <mat-icon>notification_add</mat-icon>
                    Create Alerts for High Risk
                  </button>
                </div>

                <!-- Results Filter -->
                <div class="results-filter">
                  <mat-form-field appearance="outline">
                    <mat-label>Filter by Status</mat-label>
                    <mat-select [(value)]="bulkResultsFilter" (selectionChange)="filterBulkResults()">
                      <mat-option value="all">All Results</mat-option>
                      <mat-option value="high-risk">High Risk Only</mat-option>
                      <mat-option value="medium-risk">Medium Risk Only</mat-option>
                      <mat-option value="low-risk">Low Risk Only</mat-option>
                      <mat-option value="clear">Clear Only</mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline">
                    <mat-label>Search Customer</mat-label>
                    <input matInput [(ngModel)]="bulkSearchTerm" (input)="filterBulkResults()">
                    <mat-icon matSuffix>search</mat-icon>
                  </mat-form-field>
                </div>

                <!-- Results Table -->
                <mat-table [dataSource]="filteredBulkResults()" class="bulk-results-table" matSort>
                  <ng-container matColumnDef="name">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Customer Name</mat-header-cell>
                    <mat-cell *matCellDef="let result">{{ result.customerName }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="country">
                    <mat-header-cell *matHeaderCellDef>Country</mat-header-cell>
                    <mat-cell *matCellDef="let result">{{ result.country || 'N/A' }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="riskScore">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Risk Score</mat-header-cell>
                    <mat-cell *matCellDef="let result">
                      <div class="risk-score" [class]="getRiskClass(result.riskScore)">
                        {{ result.riskScore }}%
                      </div>
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="matches">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Matches</mat-header-cell>
                    <mat-cell *matCellDef="let result">
                      <mat-chip-set *ngIf="result.matchCount > 0">
                        <mat-chip>{{ result.matchCount }}</mat-chip>
                      </mat-chip-set>
                      <span *ngIf="result.matchCount === 0">None</span>
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="status">
                    <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
                    <mat-cell *matCellDef="let result">
                      <span class="status-badge" [class]="getStatusClass(result.status)">
                        {{ result.status }}
                      </span>
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="actions">
                    <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
                    <mat-cell *matCellDef="let result">
                      <button mat-icon-button [matMenuTriggerFor]="actionMenu">
                        <mat-icon>more_vert</mat-icon>
                      </button>
                      <mat-menu #actionMenu="matMenu">
                        <button mat-menu-item (click)="viewBulkResultDetails(result)">
                          <mat-icon>visibility</mat-icon> View Details
                        </button>
                        <button mat-menu-item (click)="createAlertFromBulkResult(result)" 
                                *ngIf="result.matchCount > 0">
                          <mat-icon>notification_add</mat-icon> Create Alert
                        </button>
                        <button mat-menu-item (click)="approveBulkCustomer(result)">
                          <mat-icon>check_circle</mat-icon> Approve
                        </button>
                      </mat-menu>
                    </mat-cell>
                  </ng-container>
                  <mat-header-row *matHeaderRowDef="['name', 'country', 'riskScore', 'matches', 'status', 'actions']"></mat-header-row>
                  <mat-row *matRowDef="let row; columns: ['name', 'country', 'riskScore', 'matches', 'status', 'actions']"></mat-row>
                </mat-table>

                <!-- Pagination -->
                <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-tab>
  </mat-tab-group>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading()" class="loading-overlay">
    <mat-card class="loading-card">
      <mat-spinner diameter="50"></mat-spinner>
      <h3>Screening in Progress</h3>
      <p>Searching against {{ totalSources }} watchlist sources...</p>
      <div class="loading-progress">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>
    </mat-card>
  </div>

  <!-- Debug Information -->
  <div class="debug-info" style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px;">
    <h4>Debug Info:</h4>
    <p>Has result: {{ !!result() }}</p>
    <p>Is loading: {{ isLoading() }}</p>
    <p>Bulk results length: {{ bulkResults().length }}</p>
    <p>Should show results: {{ result() && !isLoading() && bulkResults().length === 0 }}</p>
    <p>Result matches count: {{ result()?.matches?.length || 0 }}</p>
  </div>

  <!-- Enhanced Results Section -->
  <div *ngIf="result() && !isLoading()" class="results-container">
    <mat-tab-group>
      <!-- Screening Results -->
      <mat-tab label="Results">
        <!-- Quick Actions Panel -->
        <div class="quick-actions" *ngIf="result()">
          <button mat-raised-button color="primary" (click)="approveCustomer()">
            <mat-icon>check_circle</mat-icon>
            <span>Approve</span>
          </button>
          <button mat-raised-button color="warn" (click)="flagForReview()">
            <mat-icon>flag</mat-icon>
            <span>Flag for Review</span>
          </button>
          <button mat-raised-button color="accent" (click)="requestEDD()">
            <mat-icon>assignment</mat-icon>
            <span>Request EDD</span>
          </button>
        </div>
        
        <app-screening-results
          [result]="result()"
          [onCreateAlert]="createAlert.bind(this)">
        </app-screening-results>
      </mat-tab>
      
      <!-- AI Suggestions -->
      <mat-tab label="AI Insights" *ngIf="aiSuggestions()">
        <mat-card class="ai-suggestions">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>psychology</mat-icon>
              AI-Powered Insights
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="suggestion-section">
              <h4>Recommended Action</h4>
              <p class="recommendation">{{ aiSuggestions().recommendedAction }}</p>
              <div class="confidence">Confidence: {{ (aiSuggestions().confidence * 100) | number:'1.0-0' }}%</div>
            </div>
            
            <div class="suggestion-section">
              <h4>Risk Factors</h4>
              <mat-chip-set>
                <mat-chip *ngFor="let factor of aiSuggestions().riskFactors">{{ factor }}</mat-chip>
              </mat-chip-set>
            </div>
            
            <div class="suggestion-section">
              <h4>Similar Cases</h4>
              <div *ngFor="let case of aiSuggestions().similarCases" class="similar-case">
                <span class="case-name">{{ case.name }}</span>
                <span class="case-score">Risk: {{ (case.riskScore * 100) | number:'1.0-0' }}%</span>
                <span class="case-outcome">{{ case.outcome }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </mat-tab>
      
      <!-- Screening History -->
      <mat-tab label="History" *ngIf="screeningHistory().length > 0">
        <mat-card class="history-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>history</mat-icon>
              Screening History
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="history-timeline">
              <div *ngFor="let screening of screeningHistory()" class="history-item">
                <div class="history-date">{{ screening.date | date:'short' }}</div>
                <div class="history-action">{{ screening.action }}</div>
                <div class="history-user">by {{ screening.user }}</div>
                <div class="history-result">{{ screening.result }}</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
